# Natter 服务管理器 v1.0

基于 Natter 的图形化端口映射工具，用于穿透全锥形 NAT

## 软件简介

Natter 服务管理器是一个基于 Python 和 Tkinter 开发的图形用户界面程序，专门用于管理和配置 Natter 端口映射工具。它提供了直观的界面来启动、停止和配置 Natter 服务，无需记忆复杂的命令行参数。

## 功能特性

### 🚀 一键服务管理
简单直观的启动/停止按钮，轻松管理 Natter 服务状态

### ⚙️ 图形化配置
通过标签页界面配置所有 Natter 参数，支持绑定模式和转发模式

### 🔍 NAT 类型检测
异步检测 NAT 类型，不会阻塞 GUI 界面，检测结果清晰显示

### 📝 实时日志监控
实时显示 Natter 运行日志，支持清空和导出日志功能

### 🔄 配置持久化
自动保存和加载用户配置，下次启动无需重新设置

### 📁 脚本支持
完整的 -e 参数支持，配置脚本在映射地址变化时执行

## 部署和运行

### 系统要求
- Windows 7 或更高版本的64位系统
- Natter 可执行文件 (natter.exe)

## 使用说明

### 主界面
主界面包含以下主要区域：
- **服务状态**：显示 Natter 服务的运行状态（运行中/未运行）
- **控制按钮**：启动服务、停止服务、配置、检测 NAT 类型
- **运行日志**：实时显示 Natter 的输出信息，支持清空和导出

### 菜单功能

| 菜单 | 功能 |
|------|------|
| 文件 | 导出日志、退出程序 |
| 设置 | 打开配置对话框 |
| 日志 | 清空日志、导出日志 |
| 工具 | 检测 NAT 类型 |
| 帮助 | 显示关于信息 |

### 配置说明
配置对话框包含四个标签页：

#### 基本设置
- **UDP 模式 (-u)**：启用 UDP 模式
- **启用 UPnP/IGD 发现 (-U)**：启用 UPnP 自动端口映射
- **详细模式 (-v)**：显示详细调试信息
- **映射地址改变时退出 (-q)**：检测到映射地址变化时自动退出
- **STUN 服务器地址 (-s)**：自定义 STUN 服务器地址
- **保活间隔 (-k)**：设置保活包发送间隔（秒）

#### 绑定设置
- **网络接口/IP (-i)**：指定绑定的网络接口或 IP 地址
- **绑定端口 (-b)**：指定绑定的本地端口

#### 转发设置
- **转发方法 (-m)**：选择转发方法（iptables、nftables、socat、gost、socket）
- **目标 IP 地址 (-t)**：指定转发目标 IP 地址
- **目标端口 (-p)**：指定转发目标端口
- **持续重试直到目标端口打开 (-r)**：持续重试直到目标端口可用

#### 脚本设置
- **脚本路径 (-e)**：设置映射地址变化时执行的脚本路径
- 脚本将接收以下环境变量：
  - `NATTER_EXTERNAL_IP` - 外部 IP 地址
  - `NATTER_EXTERNAL_PORT` - 外部端口
  - `NATTER_INTERNAL_IP` - 内部 IP 地址
  - `NATTER_INTERNAL_PORT` - 内部端口
  - `NATTER_PROTOCOL` - 协议类型 (TCP/UDP)

> **重要：** 绑定模式和转发模式参数不能同时使用，请在配置时注意选择其中一种模式。

## 故障排除

### 常见问题

| 问题 | 解决方案 |
|------|----------|
| 启动服务失败，提示"未找到 natter 可执行文件" | 确保 `natter.exe` 位于程序同一目录或系统 PATH 环境变量中 |
| NAT 类型检测超时 | 检查网络连接，确保 STUN 服务器可访问，或尝试更换 STUN 服务器 |
| 绑定模式和转发模式冲突 | 确保只使用其中一种模式，两种模式的参数不能同时设置 |
| 端口绑定失败 | 检查端口是否被其他程序占用，或尝试使用管理员权限运行 |

### 日志分析
如果遇到问题，请查看运行日志区域的信息：
- **错误信息**：程序会显示详细的错误信息，帮助诊断问题
- **Natter 输出**：实时显示 Natter 工具的输出，包含连接状态和错误信息
- **导出日志**：可以使用导出功能保存日志，便于后续分析

## 技术信息

### 多线程处理
程序使用多线程技术确保界面响应性：
- **主线程**：处理用户界面和事件响应
- **状态监控线程**：监控 Natter 进程状态和输出
- **NAT 检测线程**：异步执行 NAT 类型检测

### 兼容性
本程序与 Natter 工具完全兼容，支持所有 Natter 命令行参数，并通过图形界面提供更友好的配置方式。

## 许可证信息

Natter 服务管理器基于 MIT 许可证发布，用户可以自由使用、修改和分发本软件。

本软件基于 Natter 工具开发，Natter 工具的许可证信息请参考其官方文档。

---

Natter 服务管理器 © 2025

基于 Natter 的图形化端口映射工具